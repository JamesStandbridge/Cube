DROP TABLE stock_move;

CREATE TABLE stock_move (
    id UUID NOT NULL, 
    account_id INT NOT NULL, 
    shop_id INT NOT NULL, 
    product_item_id INT NOT NULL, 
    operator_id INT NOT NULL, 
    cash_item_id INT DEFAULT NULL, 
    reception_id INT DEFAULT NULL, 
    type VARCHAR(255) NOT NULL, 
    value INT NOT NULL, 
    created_at TIMESTAMP(0) 
    WITHOUT TIME ZONE NOT NULL, 
    is_archived BOOLEAN NOT NULL, 
    reference VARCHAR(255) NOT NULL, 
    PRIMARY KEY(id,account_id)
) PARTITION BY HASH(account_id);

ALTER TABLE stock_move ADD CONSTRAINT FK_F6246FBC9B6B5FBA FOREIGN KEY (account_id) REFERENCES account (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE stock_move ADD CONSTRAINT FK_F6246FBC4D16C4DD FOREIGN KEY (shop_id) REFERENCES shop (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE stock_move ADD CONSTRAINT FK_F6246FBCC3B649EE FOREIGN KEY (product_item_id) REFERENCES product_item (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE stock_move ADD CONSTRAINT FK_F6246FBC584598A3 FOREIGN KEY (operator_id) REFERENCES "user" (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE stock_move ADD CONSTRAINT FK_F6246FBC4C834002 FOREIGN KEY (cash_item_id) REFERENCES cash_item (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE stock_move ADD CONSTRAINT FK_F6246FBC7C14DF52 FOREIGN KEY (reception_id) REFERENCES reception (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
CREATE UNIQUE INDEX UNIQ_F6246FBCBF396750 ON stock_move (id, account_id);
CREATE INDEX IDX_F6246FBC9B6B5FBA ON stock_move (account_id);
CREATE INDEX IDX_F6246FBC4D16C4DD ON stock_move (shop_id);
CREATE INDEX IDX_F6246FBCC3B649EE ON stock_move (product_item_id);
CREATE INDEX IDX_F6246FBC584598A3 ON stock_move (operator_id);
CREATE INDEX IDX_F6246FBC4C834002 ON stock_move (cash_item_id);
CREATE INDEX IDX_F6246FBC7C14DF52 ON stock_move (reception_id);

CREATE TABLE stock_move_0 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 0);
CREATE TABLE stock_move_1 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 1);
CREATE TABLE stock_move_2 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 2);
CREATE TABLE stock_move_3 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 3);
CREATE TABLE stock_move_4 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 4);
CREATE TABLE stock_move_5 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 5);
CREATE TABLE stock_move_6 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 6);
CREATE TABLE stock_move_7 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 7);
CREATE TABLE stock_move_8 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 8);
CREATE TABLE stock_move_9 PARTITION OF stock_move FOR VALUES WITH (MODULUS 10, REMAINDER 9);

